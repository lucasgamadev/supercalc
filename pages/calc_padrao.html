<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Calculadora padrão simples e eficiente para realizar operações matemáticas básicas"
    />
    <title>Calculadora Padrão</title>
    <!-- TailwindCSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/assets/css/styles.css">
    <!-- Componente de fundo -->
    <script src="/assets/js/components/background.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: '#e3f2fd',
                100: '#bbdefb',
                200: '#90caf9',
                300: '#64b5f6',
                400: '#42a5f5',
                500: '#2196f3',
                600: '#1e88e5',
                700: '#1976d2',
                800: '#1565c0',
                900: '#0d47a1',
              },
              secondary: {
                50: '#e0f7fa',
                100: '#b2ebf2',
                200: '#80deea',
                300: '#4dd0e1',
                400: '#26c6da',
                500: '#00bcd4',
                600: '#00acc1',
                700: '#0097a7',
                800: '#00838f',
                900: '#006064',
              },
            },
            fontFamily: {
              'roboto': ['Roboto', 'sans-serif'],
            },
          },
        },
      }
    </script>
    <!-- Importando Materialize CSS e Ícones -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
      rel="stylesheet"
    />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        font-family: "Roboto", sans-serif;
      }

      #historico-container {
        position: relative;
        width: 100%;
        transition: opacity 0.3s ease;
        opacity: 0;
      }

      #historico-container.show {
        opacity: 1;
      }

      body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
      }

      .container-principal {
        position: relative;
        display: flex;
        flex-direction: row;
        align-items: flex-start;
        width: 100%;
        max-width: 900px;
        padding: 5px;
        margin: 0 auto;
        margin-top: 10px;
      }

      .container-principal .row {
        display: flex;
        flex-wrap: wrap;
        width: 100%;
      }

      .container-principal .col {
        display: flex;
      }

      .card {
        width: 100%;
        max-width: 900px;
        padding: 10px;
        margin: 5px;
        background: rgba(255, 255, 255, 0.85);
        border-radius: 12px !important;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        display: flex;
        flex-direction: column;
      }

      .card-content {
        padding: 10px !important;
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      #display {
        width: 100%;
        background: rgba(240, 248, 255, 0.85);
        border: 1px solid rgba(0, 123, 255, 0.2);
        border-radius: 8px;
        padding: 15px;
        font-size: 2rem;
        text-align: right;
        margin-bottom: 15px;
        min-height: 70px;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        box-shadow: inset 0 1px 5px rgba(0, 0, 0, 0.1);
        color: #333;
        font-weight: 500;
        overflow: hidden;
        white-space: nowrap;
        transition: all 0.2s ease;
      }

      .calculadora {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-gap: 10px;
        margin-bottom: 15px;
      }

      .calculadora button {
        font-size: 1.25rem;
        padding: 15px 5px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        color: #fff;
        transition: all 0.2s ease;
        font-weight: 500;
        min-height: 50px;
      }

      .numero {
        background: linear-gradient(135deg, #42a5f5, #2196f3);
        color: white;
      }

      .numero:hover {
        background: linear-gradient(135deg, #2196f3, #1976d2);
        transform: scale(1.05);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        transition: all 0.2s ease;
      }

      .operador {
        background: linear-gradient(135deg, #26c6da, #00bcd4);
      }

      .operador:hover {
        background: linear-gradient(135deg, #00bcd4, #0097a7);
        transform: scale(1.05);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        transition: all 0.2s ease;
      }

      .limpar {
        background: linear-gradient(135deg, #ef5350, #f44336);
      }

      .limpar:hover {
        background: linear-gradient(135deg, #f44336, #d32f2f);
        transform: scale(1.05);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        transition: all 0.2s ease;
      }

      .backspace {
        background: linear-gradient(135deg, #ffca28, #ffc107);
        color: #333 !important;
      }

      .backspace:hover {
        background: linear-gradient(135deg, #ffc107, #ffb300);
        transform: scale(1.05);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        transition: all 0.2s ease;
      }

      .igual {
        background: linear-gradient(135deg, #66bb6a, #4caf50);
      }

      .igual:hover {
        background: linear-gradient(135deg, #4caf50, #388e3c);
        transform: scale(1.05);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        transition: all 0.2s ease;
      }

      .span-2 {
        grid-column: span 2;
      }

      /* Estilos para o container do histórico e scrollbar - revisão completa */
      .historico-wrapper {
        position: relative;
        height: 380px; /* Altura fixa para garantir o scroll */
        margin-top: 10px;
        margin-bottom: 10px; /* Mantendo igual ao espaçamento superior */
        border-radius: 8px;
        background: rgba(217, 217, 217, 0.05);
        display: block; /* Alterado de flex para block */
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
        overflow: hidden; /* Contém overflow apenas neste nível */
        padding: 10px 0 10px 10px; /* Espaço à esquerda, em cima e embaixo, mas não à direita */
      }

      /* Estilo direto e simplificado para o histórico */
      #historico-list {
        height: calc(100% - 20px); /* Ajustado para considerar o padding superior e inferior */
        width: calc(100% - 10px); /* Ajustado para considerar somente o padding esquerdo */
        margin: 0;
        padding: 0; /* Removido padding extra à direita */
        list-style: none;
        overflow-y: auto !important; /* Alterado de scroll para auto - só mostra quando necessário */
        overflow-x: hidden;
        position: relative;
        z-index: 1; /* Garante que a lista fique acima de outros elementos */
        transform: translateZ(0); /* Ativa aceleração de hardware */
        will-change: scroll-position; /* Otimização para rolagem */
      }

      /* Estilos limpos para os itens da lista */
      #historico-list .collection-item {
        padding: 8px 10px !important;
        margin-bottom: 5px !important;
        background-color: transparent !important;
        border-bottom: 1px solid rgba(0,0,0,0.05) !important;
      }

      /* Personalização da barra de rolagem - revisão completa */
      #historico-list::-webkit-scrollbar {
        width: 8px;
        background-color: transparent;
      }

      #historico-list::-webkit-scrollbar-track {
        background: rgba(219, 234, 254, 0.5);
        border-radius: 4px;
      }

      #historico-list::-webkit-scrollbar-thumb {
        background: rgba(37, 99, 235, 0.6);
        border-radius: 4px;
        border: 2px solid transparent;
        background-clip: padding-box;
      }

      #historico-list::-webkit-scrollbar-thumb:hover {
        background: rgba(29, 78, 216, 0.8);
        border: 2px solid transparent;
        background-clip: padding-box;
      }

      /* Para Firefox */
      #historico-list {
        scrollbar-width: thin;
        scrollbar-color: rgba(37, 99, 235, 0.6) rgba(219, 234, 254, 0.5);
      }

      /* Limpar conflitos com Materialize */
      .collection {
        border: none !important;
        margin: 0 !important;
        padding: 0 !important;
        overflow: visible !important;
      }
      
      /* Remover qualquer overflow oculto que possa estar interferindo */
      .card-content, .card {
        overflow: visible !important;
      }

      .resultado-item {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.51), rgba(250, 250, 250, 0.51));
        border-radius: 12px;
        transition: all 0.3s ease;
        border-left: 4px solid #2196f3;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.03);
        margin-bottom: 15px;
        transform-origin: center;
      }

      .resultado-item:hover {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06);
        transform: translateY(-1px) scale(1.005);
      }

      .historico-conteudo {
        display: flex;
        width: 100%;
        align-items: center;
      }

      .historico-expressao {
        font-size: 1rem;
        color: #333;
        font-weight: 500;
        width: 100%;
        padding: 5px;
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 5px;
      }

      .historico-expressao::before {
        content: '';
        display: none;
      }

      .historico-expressao .resultado-valor {
        font-weight: 600;
        display: inline-block;
        position: relative;
        padding: 2px 8px;
        border-radius: 4px;
        transition: all 0.3s ease;
      }

      .historico-expressao .resultado-positivo {
        color: #4caf50;
        background-color: rgba(76, 175, 80, 0.1);
      }

      .historico-expressao .resultado-zero {
        color: #757575;
        background-color: rgba(117, 117, 117, 0.1);
      }

      .historico-expressao .resultado-negativo {
        color: #f44336;
        background-color: rgba(244, 67, 54, 0.1);
      }

      .historico-expressao .resultado-valor:hover {
        transform: scale(1.05);
      }

      .historico-expressao .resultado-positivo:hover {
        background-color: rgba(76, 175, 80, 0.2);
      }

      .historico-expressao .resultado-zero:hover {
        background-color: rgba(117, 117, 117, 0.2);
      }

      .historico-expressao .resultado-negativo:hover {
        background-color: rgba(244, 67, 54, 0.2);
      }

      .material-icons.operator-icon {
        margin-right: 8px;
        font-size: 18px;
        vertical-align: middle;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
        border-radius: 6px;
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        transition: all 0.2s ease;
      }

      .symbol-container {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 26px;
        height: 26px;
        border-radius: 6px;
        margin-right: 8px;
        position: relative;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        text-align: center;
        transition: box-shadow 0.2s ease;
      }

      /* Reduzindo efeito de sombra no hover */
      .resultado-item:hover .symbol-container {
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .operador-soma { background: linear-gradient(to bottom, #4caf50, #8bc34a); }
      .operador-subtracao { background: linear-gradient(to bottom, #f44336, #ff5252); }
      .operador-multiplicacao { background: linear-gradient(to bottom, #ff9800, #ffb74d); }
      .operador-divisao { background: linear-gradient(to bottom, #9c27b0, #ba68c8); }
      .operador-porcentagem { background: linear-gradient(to bottom, #00bcd4, #4dd0e1); }

      .historico-resultado {
        font-weight: 600;
        width: 40px;
        height: 40px;
        background: #66bb6a;
        color: white;
        border-radius: 50%;
        font-size: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease;
        position: relative;
        text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
      }

      /* Ajustes responsivos */
      @media (max-width: 768px) {
        .container-principal {
          flex-direction: column;
          align-items: center;
          padding: 10px;
        }

        .container-principal .row {
          flex-direction: column;
        }

        #historico-list {
          max-height: 300px;
        }
        
        .calculadora button {
          padding: 12px 5px;
          font-size: 1.1rem;
          min-height: 45px;
        }
        
        #display {
          padding: 12px;
          font-size: 1.75rem;
          min-height: 60px;
        }
      }

      @media (max-width: 480px) {
        body {
          padding: 2px;
        }
        
        .calculadora button {
          padding: 10px 5px;
          font-size: 1rem;
          min-height: 40px;
        }
        
        #display {
          padding: 10px;
          font-size: 1.5rem;
          min-height: 50px;
        }
        
        .card-title {
          font-size: 20px;
        }
        
        .resultado-item {
          padding: 8px 12px;
        }
      }

      /* Ajustes para telas muito pequenas */
      @media (max-width: 320px) {
        .card-title {
          font-size: 18px;
          margin-bottom: 10px !important;
        }
        
        .calculadora button {
          padding: 8px 4px;
          font-size: 0.9rem;
          min-height: 36px;
        }
        
        #display {
          padding: 8px;
          font-size: 1.25rem;
          min-height: 45px;
        }
        
        .resultado-item {
          padding: 6px 10px;
          font-size: 0.85rem;
        }
      }

      /* Ajuste do toast para diferentes tamanhos de tela */
      @media (max-width: 480px) {
        #toast-container {
          width: 90% !important;
          left: 5% !important;
          transform: translateY(-50%) !important;
        }

        .toast {
          font-size: 14px !important;
          padding: 10px 15px !important;
          width: 100% !important;
        }
      }

      /* Estilos para os toasts - centralização */
      #toast-container {
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        position: fixed !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        width: auto !important;
        max-width: none !important;
        height: auto !important;
        pointer-events: none;
      }

      /* Links de navegação */
      .nav-links {
        display: flex;
        justify-content: center;
        margin-bottom: 15px;
        margin-top: 10px;
      }

      .nav-links a {
        color: white;
        margin: 0 15px;
        display: flex;
        align-items: center;
        font-weight: 500;
        transition: all 0.2s ease;
        text-decoration: none;
        opacity: 0.9;
      }

      .nav-links a:hover {
        opacity: 1;
        transform: translateY(-2px);
      }

      .nav-links a i {
        margin-right: 6px;
      }

      /* Estilos do título e elementos especiais */
      .card-title {
        text-align: center;
        display: block;
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 15px !important;
        background: linear-gradient(45deg, #2196f3, #00bcd4);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        letter-spacing: 0.5px;
        position: relative;
        padding-bottom: 8px;
      }

      .card-title::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 40px;
        height: 2px;
        background: linear-gradient(45deg, #2196f3, #00bcd4);
        border-radius: 2px;
      }

      .btn-container {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 0; /* Removido espaço superior */
      }

      .btn-large {
        padding: 0 25px !important;
        height: 44px;
        line-height: 44px;
        font-weight: 500;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        border-radius: 50px !important;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16);
        transition: all 0.2s ease;
      }

      .btn-large:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
      }

      .btn-large:active {
        transform: translateY(1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
      }

      .btn-large i {
        font-size: 20px;
        margin-left: 5px;
      }

      .fade-in {
        animation: fadeIn 0.5s ease forwards;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .timestamp {
        display: none; /* Ocultar timestamp */
      }

      .historico-item-wrapper {
        position: relative;
        overflow: hidden;
      }

      .historico-item-wrapper::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        border-radius: 2px 0 0 2px;
        transition: all 0.3s ease;
      }

      /* Ajuste para o componente de histórico vazio */
      empty-history {
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
    </style>
  </head>
  <body class="supercalc-background">
    <noscript>
      <style>
        .no-js-message {
          background: #ff5252;
          color: white;
          padding: 20px;
          text-align: center;
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          z-index: 1000;
          font-weight: bold;
        }
        body {
          margin-top: 60px;
        }
      </style>
      <div class="no-js-message">
        Esta calculadora requer JavaScript para funcionar. Por favor, habilite o JavaScript em seu navegador.
      </div>
    </noscript>

    <!-- Navegação -->
    <div class="nav-links" style="display: flex; justify-content: center; width: 100%; margin: 30px auto 0;">
      <!-- Componente do Botão Início para SuperCalc -->
      <home-button href="/index.html" text="Início" icon="fa-home"></home-button>
    </div>
    
    <!-- Importação do componente home-button -->
    <script>
      // Verifica se o componente já foi carregado
      if (!customElements.get('home-button')) {
        // Carrega o script do componente se ainda não estiver carregado
        const script = document.createElement('script');
        script.src = '/assets/js/components/home-button.js';
        document.head.appendChild(script);
      }
    </script>
    
    <!-- Componente de fundo -->
    <script src="/assets/js/components/background.js"></script>

    <div class="container-principal">
      <div class="row">
        <!-- Coluna da Calculadora -->
        <div class="col s12 m6">
          <div class="card fade-in">
            <div class="card-content">
              <span class="card-title" role="heading" aria-level="1"><i class="fas fa-calculator mr-2"></i>Calculadora Padrão</span>
              
              <div id="display">0</div>
              
              <div class="calculadora">
                <button class="limpar" id="btn-clear">C</button>
                <button class="backspace" id="btn-backspace">⌫</button>
                <button class="operador" id="btn-percent">%</button>
                <button class="operador" id="btn-divide">÷</button>
                
                <button class="numero" id="btn-7">7</button>
                <button class="numero" id="btn-8">8</button>
                <button class="numero" id="btn-9">9</button>
                <button class="operador" id="btn-multiply">×</button>
                
                <button class="numero" id="btn-4">4</button>
                <button class="numero" id="btn-5">5</button>
                <button class="numero" id="btn-6">6</button>
                <button class="operador" id="btn-subtract">−</button>
                
                <button class="numero" id="btn-1">1</button>
                <button class="numero" id="btn-2">2</button>
                <button class="numero" id="btn-3">3</button>
                <button class="operador" id="btn-add">+</button>
                
                <button class="numero span-2" id="btn-0">0</button>
                <button class="numero" id="btn-decimal">,</button>
                <button class="igual" id="btn-equals">=</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Coluna do Histórico -->
        <div class="col s12 m6">
          <div id="historico-container" class="card fade-in show">
            <div class="card-content" style="position: relative; padding: 10px !important; padding-bottom: 50px !important;">
              <span class="card-title" role="heading" aria-level="1" style="margin-bottom: 10px;"><i class="fas fa-history mr-2"></i>Histórico de Cálculos</span>
              
              <!-- Nova div para envolver o histórico e sua barra de rolagem -->
              <div class="historico-wrapper">
                <ul id="historico-list" class="collection"></ul>
              </div>
              
              <div class="btn-container" style="margin-top: 10px; padding: 0; text-align: center; position: absolute; bottom: 10px; left: 0; right: 0;">
                <clear-history-button
                  storage-key="calculo-padrao-historico"
                  history-list-id="historico-list"
                  container-id="historico-container"
                  success-message="Histórico limpo com sucesso!"
                  empty-message="O histórico já está vazio!"
                ></clear-history-button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <!-- Importando componentes web personalizados -->
    <script src="/assets/js/components/clear-history-button.js"></script>
    <script src="/assets/js/components/toast-notification.js"></script>
    <script src="/assets/js/components/empty-history.js"></script>

    <script>
      // Variáveis para controle da calculadora
      let valorAtual = '0';
      let valorAnterior = '';
      let operacao = null;
      let resultadoExibido = false;
      const display = document.getElementById('display');
      const historicoList = document.getElementById('historico-list');
      
      // Função para mostrar toast de notificação usando o componente web
      function showToast(message, classes = 'rounded') {
        // Usa o método estático do componente ToastNotification
        ToastNotification.showToast(message, classes);
      }
      
      // Função simplificada para trocar ponto por vírgula
      function formatarDisplay(valor) {
        return valor.toString().replace('.', ',');
      }
      
      // Função para converter string para número (vírgula para ponto)
      function converterParaNumero(valor) {
        return parseFloat(valor.toString().replace(',', '.'));
      }
      
      // Atualiza o display
      function atualizarDisplay(valor = valorAtual) {
        display.textContent = valor;
      }
      
      // Adiciona um dígito ao valor atual
      function adicionarDigito(digito) {
        if (resultadoExibido) {
          valorAtual = '0';
          resultadoExibido = false;
        }
        
        if (valorAtual === '0' && digito !== ',') {
          valorAtual = digito;
        } else if (digito === ',' && !valorAtual.includes(',')) {
          valorAtual += digito;
        } else if (digito !== ',' || !valorAtual.includes(',')) {
          valorAtual += digito;
        }
        
        // Se estiver no meio de uma operação, mostra a expressão completa
        if (operacao !== null && valorAnterior !== '') {
          atualizarDisplay(`${valorAnterior} ${operacao} ${valorAtual}`);
        } else {
          atualizarDisplay(valorAtual);
        }
      }
      
      // Configura a operação
      function definirOperacao(op) {
        if (valorAtual !== '0' || valorAnterior !== '') {
          if (operacao !== null && valorAnterior !== '' && !resultadoExibido) {
            calcular();
          }
          
          operacao = op;
          valorAnterior = valorAtual;
          valorAtual = '0';
          resultadoExibido = false;
          
          atualizarDisplay(`${valorAnterior} ${op}`);
        }
      }
      
      // Realiza o cálculo
      function calcular() {
        if (operacao === null || valorAnterior === '') return;
        
        const anterior = converterParaNumero(valorAnterior);
        const atual = converterParaNumero(valorAtual);
        
        // Verifica divisão por zero
        if (operacao === '÷' && atual === 0) {
          showToast('Não é possível dividir por zero!', 'red rounded');
          limparTudo();
          return;
        }
        
        // Realiza a operação
        let resultado;
        switch (operacao) {
          case '+': resultado = anterior + atual; break;
          case '−': resultado = anterior - atual; break;
          case '×': resultado = anterior * atual; break;
          case '÷': resultado = anterior / atual; break;
          case '%': resultado = anterior * (atual / 100); break;
          default: return;
        }
        
        // Expressão simples para o histórico
        const expressao = `${valorAnterior} ${operacao} ${valorAtual} = ${formatarDisplay(resultado)}`;
        
        // Adiciona ao histórico de forma simplificada
        adicionarAoHistorico(expressao);
        
        valorAtual = formatarDisplay(resultado);
        valorAnterior = '';
        operacao = null;
        resultadoExibido = true;
        
        atualizarDisplay(valorAtual);
      }
      
      // Limpar tudo
      function limparTudo() {
        valorAtual = '0';
        valorAnterior = '';
        operacao = null;
        resultadoExibido = false;
        atualizarDisplay();
      }
      
      // Apagar último dígito
      function apagarDigito() {
        if (resultadoExibido) {
          limparTudo();
          return;
        }
        
        if (valorAtual.length > 1) {
          valorAtual = valorAtual.slice(0, -1);
        } else {
          valorAtual = '0';
        }
        
        atualizarDisplay(valorAtual);
      }
      
      // Adicionar ao histórico (versão simplificada)
      function adicionarAoHistorico(expressao) {
        // Verifica se existe o componente EmptyHistory e remove se existir
        const emptyHistory = historicoList.querySelector('empty-history');
        if (emptyHistory) {
          historicoList.removeChild(emptyHistory);
        }
        
        // Divide a expressão para separar a operação do resultado
        const partes = expressao.split('=');
        const operacao = partes[0].trim();
        const resultado = partes[1].trim();
        
        // Identifica o tipo de operação para aplicar uma cor diferente
        let operadorCor = '#2196f3'; // Azul padrão
        let operadorIcone = 'calculate';
        let operadorClasse = '';
        
        if (operacao.includes('+')) {
          operadorCor = '#4caf50'; // Verde para adição
          operadorIcone = 'add';
          operadorClasse = 'operador-soma';
        } else if (operacao.includes('−')) {
          operadorCor = '#f44336'; // Vermelho para subtração
          operadorIcone = 'remove';
          operadorClasse = 'operador-subtracao';
        } else if (operacao.includes('×')) {
          operadorCor = '#ff9800'; // Laranja para multiplicação
          operadorIcone = 'close';
          operadorClasse = 'operador-multiplicacao';
        } else if (operacao.includes('÷')) {
          operadorCor = '#9c27b0'; // Roxo para divisão
          operadorIcone = 'calculate';  // Substituído "functions" por "calculate"
          operadorClasse = 'operador-divisao';
        } else if (operacao.includes('%')) {
          operadorCor = '#00bcd4'; // Ciano para porcentagem
          operadorIcone = 'percent';
          operadorClasse = 'operador-porcentagem';
        }
        
        // Determinar a classe do resultado com base no valor
        let resultadoClasse = 'resultado-positivo';
        const valorNumerico = parseFloat(resultado.replace(',', '.'));
        
        if (valorNumerico === 0) {
          resultadoClasse = 'resultado-zero';
        } else if (valorNumerico < 0) {
          resultadoClasse = 'resultado-negativo';
        }
        
        // Cria e adiciona o item ao histórico com estilo melhorado
        const li = document.createElement('li');
        li.className = 'collection-item resultado-item fade-in';
        li.style.borderLeftColor = operadorCor;
        
        // Create symbols with simple square styling
        let iconContent;
        if (operacao.includes('÷')) {
          iconContent = `<div class="symbol-container ${operadorClasse}"><span style="color: white; font-size: 16px; font-weight: bold;">÷</span></div>`;
        } else if (operacao.includes('×')) {
          iconContent = `<div class="symbol-container ${operadorClasse}"><span style="color: white; font-size: 16px; font-weight: bold;">×</span></div>`;
        } else if (operacao.includes('−')) {
          iconContent = `<div class="symbol-container ${operadorClasse}"><span style="color: white; font-size: 16px; font-weight: bold;">−</span></div>`;
        } else if (operacao.includes('+')) {
          iconContent = `<div class="symbol-container ${operadorClasse}"><span style="color: white; font-size: 16px; font-weight: bold;">+</span></div>`;
        } else if (operacao.includes('%')) {
          iconContent = `<div class="symbol-container ${operadorClasse}"><span style="color: white; font-size: 16px; font-weight: bold;">%</span></div>`;
        } else {
          iconContent = `<div class="symbol-container" style="background: linear-gradient(to bottom, #2196f3, #64b5f6);"><i class="material-icons" style="color: white; font-size: 16px;">${operadorIcone}</i></div>`;
        }
        
        li.innerHTML = `
          <div class="historico-item-wrapper">
            <div class="historico-conteudo">
              <span class="historico-expressao" style="display: flex; align-items: center;">
                ${iconContent}
                <span style="flex: 1;">${operacao} =</span>
                <span class="resultado-valor ${resultadoClasse}">${resultado}</span>
              </span>
            </div>
          </div>
        `;
        
        // Efeito de entrada suave
        li.style.opacity = '0';
        li.style.transform = 'translateY(-10px)';
        
        // Removido limite de itens visíveis - o scroll agora cuidará disso
        /* 
        const maxVisibleItems = 5;
        if (historicoList.children.length >= maxVisibleItems) {
          // Aplica um efeito de fade out no último item
          const lastItem = historicoList.lastElementChild;
          if (lastItem) {
            lastItem.style.transition = 'all 0.3s ease';
            lastItem.style.opacity = '0';
            lastItem.style.transform = 'translateY(10px) scale(0.95)';
            
            // Remove após a animação
            setTimeout(() => {
              if (lastItem.parentNode === historicoList) {
                historicoList.removeChild(lastItem);
              }
            }, 300);
          }
        }
        */
        
        historicoList.prepend(li);
        
        // Força o reflow para a animação funcionar
        li.offsetHeight;
        
        // Aplica a transição
        li.style.transition = 'all 0.3s ease';
        li.style.opacity = '1';
        li.style.transform = 'translateY(0)';
        
        // Armazenar no localStorage de forma simplificada com timestamp
        const historicoItem = {
          expressao: expressao
        };
        salvarHistoricoItem(JSON.stringify(historicoItem));
        
        // Mostrar o container de histórico
        document.getElementById('historico-container').classList.add('show');
      }
      
      // Salvar um novo item no histórico (simplificado)
      function salvarHistoricoItem(expressao) {
        const itens = obterHistoricoSalvo() || [];
        itens.unshift(expressao); // Adiciona no início do array
        
        // Aumentar para permitir mais itens no histórico 
        if (itens.length > 30) { // Aumentado de 10 para 30
          itens.pop(); // Remove o último item
        }
        
        localStorage.setItem('calculo-padrao-historico', JSON.stringify(itens));
      }
      
      // Obter histórico salvo no localStorage
      function obterHistoricoSalvo() {
        const historico = localStorage.getItem('calculo-padrao-historico');
        return historico ? JSON.parse(historico) : null;
      }
      
      // Carregar histórico do localStorage (simplificado)
      function carregarHistorico() {
        const itens = obterHistoricoSalvo();
        
        if (itens && itens.length > 0) {
          document.getElementById('historico-container').classList.add('show');
          
          // Removido limite de exibição - mostrar todos os itens
          // const maxVisibleItems = 5;
          // const itemsToShow = itens.slice(0, maxVisibleItems);
          
          // Mostrar todos os itens do histórico
          itens.forEach((item, index) => {
            // Verifica se o item é um objeto JSON serializado
            let expressao;
            
            try {
              const itemObj = JSON.parse(item);
              expressao = itemObj.expressao;
            } catch (e) {
              // Se não for um objeto, assume que é apenas a expressão
              expressao = item;
            }
            
            // Divide a expressão para separar a operação do resultado
            const partes = expressao.split('=');
            const operacao = partes[0].trim();
            const resultado = partes[1]?.trim() || '';
            
            // Identifica o tipo de operação para aplicar uma cor diferente
            let operadorCor = '#2196f3'; // Azul padrão
            let operadorIcone = 'calculate';
            let operadorClasse = '';
            
            if (operacao.includes('+')) {
              operadorCor = '#4caf50'; // Verde para adição
              operadorIcone = 'add';
              operadorClasse = 'operador-soma';
            } else if (operacao.includes('−')) {
              operadorCor = '#f44336'; // Vermelho para subtração
              operadorIcone = 'remove';
              operadorClasse = 'operador-subtracao';
            } else if (operacao.includes('×')) {
              operadorCor = '#ff9800'; // Laranja para multiplicação
              operadorIcone = 'close';
              operadorClasse = 'operador-multiplicacao';
            } else if (operacao.includes('÷')) {
              operadorCor = '#9c27b0'; // Roxo para divisão
              operadorIcone = 'calculate';  // Substituído "functions" por "calculate"
              operadorClasse = 'operador-divisao';
            } else if (operacao.includes('%')) {
              operadorCor = '#00bcd4'; // Ciano para porcentagem
              operadorIcone = 'percent';
              operadorClasse = 'operador-porcentagem';
            }
            
            // Determinar a classe do resultado com base no valor
            let resultadoClasse = 'resultado-positivo';
            const valorNumerico = parseFloat(resultado.replace(',', '.'));
            
            if (valorNumerico === 0) {
              resultadoClasse = 'resultado-zero';
            } else if (valorNumerico < 0) {
              resultadoClasse = 'resultado-negativo';
            }
            
            // Create symbols with simple square styling
            let iconContent;
            if (operacao.includes('÷')) {
              iconContent = `<div class="symbol-container ${operadorClasse}"><span style="color: white; font-size: 16px; font-weight: bold;">÷</span></div>`;
            } else if (operacao.includes('×')) {
              iconContent = `<div class="symbol-container ${operadorClasse}"><span style="color: white; font-size: 16px; font-weight: bold;">×</span></div>`;
            } else if (operacao.includes('−')) {
              iconContent = `<div class="symbol-container ${operadorClasse}"><span style="color: white; font-size: 16px; font-weight: bold;">−</span></div>`;
            } else if (operacao.includes('+')) {
              iconContent = `<div class="symbol-container ${operadorClasse}"><span style="color: white; font-size: 16px; font-weight: bold;">+</span></div>`;
            } else if (operacao.includes('%')) {
              iconContent = `<div class="symbol-container ${operadorClasse}"><span style="color: white; font-size: 16px; font-weight: bold;">%</span></div>`;
            } else {
              iconContent = `<div class="symbol-container" style="background: linear-gradient(to bottom, #2196f3, #64b5f6);"><i class="material-icons" style="color: white; font-size: 16px;">${operadorIcone}</i></div>`;
            }
            
            const li = document.createElement('li');
            li.className = 'collection-item resultado-item fade-in';
            li.style.borderLeftColor = operadorCor;
            li.style.animationDelay = `${Math.min(index, 10) * 0.05}s`; // Limitar atraso de animação
            
            li.innerHTML = `
              <div class="historico-item-wrapper">
                <div class="historico-conteudo">
                  <span class="historico-expressao" style="display: flex; align-items: center;">
                    ${iconContent}
                    <span style="flex: 1;">${operacao} =</span>
                    <span class="resultado-valor ${resultadoClasse}">${resultado}</span>
                  </span>
                </div>
              </div>
            `;
            
            historicoList.prepend(li);
          });
        } else {
          // Mostrar o componente de histórico vazio
          historicoList.innerHTML = '';
          const emptyHistory = document.createElement('empty-history');
          emptyHistory.setAttribute('message', 'Nenhum cálculo no histórico');
          emptyHistory.setAttribute('sub-message', 'Os cálculos realizados aparecerão aqui');
          historicoList.appendChild(emptyHistory);
          
          // Adicionar um pequeno atraso para garantir que o componente seja renderizado antes de mostrar o container
          setTimeout(() => {
            document.getElementById('historico-container').classList.add('show');
          }, 50);
        }
        
        // Forçar um reflow para garantir que as barras de rolagem sejam calculadas corretamente
        document.getElementById('historico-list').offsetHeight;
      }
      
      // Limpar histórico
      function limparHistorico() {
        const historicoList = document.getElementById('historico-list');
        
        // Verifica se o histórico já está vazio
        if (!historicoList || historicoList.children.length === 0) {
          showToast('O histórico já está vazio!', 'orange rounded');
          return;
        }
        
        // Remove todos os itens do histórico
        historicoList.innerHTML = '';
        
        localStorage.removeItem('calculo-padrao-historico');
        
        // Adicionar o componente de histórico vazio
        const emptyHistory = document.createElement('empty-history');
        emptyHistory.setAttribute('message', 'Nenhum cálculo no histórico');
        emptyHistory.setAttribute('sub-message', 'Os cálculos realizados aparecerão aqui');
        historicoList.appendChild(emptyHistory);
        document.getElementById('historico-container').classList.add('show');
        
        showToast('Histórico limpo com sucesso!', 'green rounded');
      }
      
      // Registrar eventos para os botões
      function registrarEventos() {
        // Botões numéricos
        const botoes = {
          numeros: ['btn-0', 'btn-1', 'btn-2', 'btn-3', 'btn-4', 'btn-5', 'btn-6', 'btn-7', 'btn-8', 'btn-9'],
          operadores: {
            'btn-add': '+',
            'btn-subtract': '−',
            'btn-multiply': '×',
            'btn-divide': '÷',
            'btn-percent': '%'
          },
          especiais: {
            'btn-equals': calcular,
            'btn-clear': limparTudo,
            'btn-backspace': apagarDigito,
            'btn-decimal': () => adicionarDigito(',')
          }
        };
        
        // Registra eventos para números
        botoes.numeros.forEach(id => {
          const numero = id.replace('btn-', '');
          document.getElementById(id).addEventListener('click', () => adicionarDigito(numero));
        });
        
        // Registra eventos para operadores
        Object.entries(botoes.operadores).forEach(([id, op]) => {
          document.getElementById(id).addEventListener('click', () => definirOperacao(op));
        });
        
        // Registra eventos para botões especiais
        Object.entries(botoes.especiais).forEach(([id, funcao]) => {
          document.getElementById(id).addEventListener('click', funcao);
        });
        
        // Suporte ao teclado
        document.addEventListener('keydown', gerenciarTeclado);
      }
      
      // Gerenciar eventos de teclado
      function gerenciarTeclado(e) {
        // Números
        if (/^[0-9]$/.test(e.key)) {
          adicionarDigito(e.key);
        } 
        // Operações
        else if (e.key === '+') {
          definirOperacao('+');
        } else if (e.key === '-') {
          definirOperacao('−');
        } else if (e.key === '*') {
          definirOperacao('×');
        } else if (e.key === '/') {
          e.preventDefault(); // Previne a busca rápida no navegador
          definirOperacao('÷');
        } else if (e.key === '%') {
          definirOperacao('%');
        } 
        // Decimal
        else if (e.key === ',' || e.key === '.') {
          adicionarDigito(',');
        } 
        // Igual / Enter
        else if (e.key === '=' || e.key === 'Enter') {
          e.preventDefault();
          calcular();
        } 
        // Backspace
        else if (e.key === 'Backspace') {
          apagarDigito();
        } 
        // Escape / Delete (Limpar)
        else if (e.key === 'Escape' || e.key === 'Delete') {
          limparTudo();
        }
      }
      
      // Inicialização
      document.addEventListener('DOMContentLoaded', function() {
        registrarEventos();
        atualizarDisplay();
        carregarHistorico();
        
        // Corrigir problemas de rolagem após o carregamento completo
        setTimeout(function() {
          const historicoList = document.getElementById('historico-list');
          if (historicoList) {
            // Reset forçado para garantir rolagem
            historicoList.style.overflow = 'hidden';
            // Forçar um reflow
            historicoList.offsetHeight;
            // Restaurar scroll
            historicoList.style.overflow = 'auto';
            
            // Impedir propagação de eventos de rolagem
            historicoList.addEventListener('wheel', function(e) {
              if (this.scrollHeight > this.clientHeight) {
                e.stopPropagation();
              }
            }, { passive: false }); // Important para permitir preventDefault
            
            // Garantir que o touch scroll funcione em dispositivos móveis
            historicoList.addEventListener('touchstart', function(e) {
              if (this.scrollHeight > this.clientHeight) {
                e.stopPropagation();
              }
            }, { passive: true });
            
            historicoList.addEventListener('touchmove', function(e) {
              if (this.scrollHeight > this.clientHeight) {
                e.stopPropagation();
              }
            }, { passive: true });
          }
        }, 100); // Atraso pequeno para garantir que tudo esteja renderizado
      });
    </script>
  </body>
</html>
