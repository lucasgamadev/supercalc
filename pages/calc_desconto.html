<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Calculadora de desconto simples e eficiente para calcular valores com desconto em Reais"
    />
    <title>Calculadora de Desconto</title>
    <!-- TailwindCSS via CDN - Apenas para desenvolvimento. Para produção usar método recomendado: https://tailwindcss.com/docs/installation -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/assets/css/styles.css" />
    <!-- Componente de fundo -->
    <script src="/assets/js/components/background.js"></script>

    <script>
      // Função para mostrar toast
      document.addEventListener('DOMContentLoaded', function () {
        // Carregar o histórico quando a página carregar
        carregarHistorico();
      });

      // Listeners para eventos de cópia
      document.addEventListener('copy-success', function (e) {
        showToast(e.detail.message, 'green rounded');
      });
    </script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: '#e3f2fd',
                100: '#bbdefb',
                200: '#90caf9',
                300: '#64b5f6',
                400: '#42a5f5',
                500: '#2196f3',
                600: '#1e88e5',
                700: '#1976d2',
                800: '#1565c0',
                900: '#0d47a1',
              },
              secondary: {
                50: '#e0f7fa',
                100: '#b2ebf2',
                200: '#80deea',
                300: '#4dd0e1',
                400: '#26c6da',
                500: '#00bcd4',
                600: '#00acc1',
                700: '#0097a7',
                800: '#00838f',
                900: '#006064',
              },
            },
            fontFamily: {
              roboto: ['Roboto', 'sans-serif'],
            },
          },
        },
      };
    </script>
    <!-- Importando Materialize CSS e Ícones -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        font-family: 'Roboto', sans-serif;
      }

      body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
      }

      #historico-container {
        position: relative;
        width: 100%;
        transition: opacity 0.3s ease;
        opacity: 0;
      }

      #historico-container.show {
        opacity: 1;
      }

      .container-principal {
        position: relative;
        display: flex;
        flex-direction: row;
        align-items: flex-start;
        width: 100%;
        max-width: 900px;
        padding: 5px;
        margin: 0 auto;
        margin-top: 10px;
      }

      .container-principal .row {
        display: flex;
        flex-wrap: wrap;
        width: 100%;
      }

      .container-principal .col {
        display: flex;
      }

      .card {
        width: 100%;
        max-width: 900px;
        padding: 10px;
        margin: 5px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 12px !important;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        display: flex;
        flex-direction: column;
      }

      .card-content {
        padding: 10px !important;
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .collection {
        border: none !important;
        margin: 0 !important;
      }

      @media (max-width: 768px) {
        .container-principal {
          flex-direction: column;
          align-items: center;
        }

        .container-principal .row {
          flex-direction: column;
        }

        #historico-list {
          max-height: 300px;
        }
      }

      .card-title {
        text-align: center;
        display: block;
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 15px !important;
        background: linear-gradient(45deg, #2196f3, #00bcd4);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        letter-spacing: 0.5px;
        position: relative;
        padding-bottom: 8px;
      }

      .card-title::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 40px;
        height: 2px;
        background: linear-gradient(45deg, #2196f3, #00bcd4);
        border-radius: 2px;
      }

      @media (max-width: 480px) {
        .card-title {
          font-size: 20px;
        }
      }

      .row {
        margin-bottom: 0;
      }

      .input-field {
        margin-bottom: 12px;
      }

      .input-field input {
        margin-bottom: 0 !important;
        padding: 0 !important;
        text-indent: 0 !important;
        box-sizing: border-box;
        font-size: 14px;
        font-family: 'Roboto', sans-serif !important;
      }

      .input-field label {
        left: 10px;
        font-size: 14px;
        font-family: 'Roboto', sans-serif !important;
      }

      .btn-container {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
      }

      .btn {
        flex: 1;
        height: 36px;
        line-height: 36px;
        font-size: 14px;
        text-transform: none;
        border-radius: 6px;
        box-shadow: none;
        font-family: 'Roboto', sans-serif !important;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 2px;
        position: relative;
        overflow: hidden;
      }

      /* Shimmer effect for buttons */
      .btn::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: rgba(255, 255, 255, 0.1);
        transform: rotate(45deg);
        animation: shimmer 2s infinite;
        pointer-events: none;
      }

      #resultado-container {
        background: linear-gradient(to bottom, #ffffff, #f7f9fc);
        border-radius: 16px;
        padding: 20px;
        margin-top: 15px;
        border: 1px solid rgba(224, 224, 224, 0.5);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.08);
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      #resultado-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, #2196f3, #00bcd4);
      }

      #resultado-container:hover {
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.12);
      }

      .resultado-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px; /* Aumentado o padding lateral para 16px */
        border: 1px solid rgba(0, 123, 255, 0.2);
        border-radius: 8px;
        background: rgba(240, 248, 255, 0.8);
        font-size: 14px;
        font-family: 'Roboto', sans-serif;
        position: relative;
        overflow: hidden;
        margin-bottom: 10px;
        box-shadow: inset 0 1px 5px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      .material-icons {
        font-size: 18px !important;
      }

      /* Reduzindo o espaçamento entre o ícone e o texto nos botões */
      .material-icons.left {
        margin-right: 2px !important;
        vertical-align: middle !important;
        position: relative;
        top: -1px;
      }

      /* Container para centralizar o botão de voltar */
      .btn-voltar-container {
        display: flex;
        justify-content: center;
        width: 100%;
        margin: 30px auto 0;
        max-width: 900px;
        position: relative;
        z-index: 10;
        gap: 10px; /* Adiciona espaçamento entre os botões */
        flex-wrap: wrap; /* Permite que os botões quebrem para a próxima linha em telas pequenas */
      }

      /* Estilo para o botão de voltar */
      .btn-voltar {
        display: inline-flex;
        align-items: center;
        background: linear-gradient(135deg, #2196f3, #00bcd4);
        color: white;
        padding: 0 18px;
        height: 36px;
        border-radius: 18px;
        font-size: 14px;
        font-weight: 500;
        box-shadow: 0 3px 8px rgba(33, 150, 243, 0.4);
        transition: all 0.3s ease;
        text-decoration: none;
        width: fit-content;
        margin-bottom: 15px;
        position: relative;
        overflow: hidden;
      }

      .btn-voltar:hover {
        box-shadow: 0 4px 8px rgba(33, 150, 243, 0.4);
      }

      .btn-voltar::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: rgba(255, 255, 255, 0.1);
        transform: rotate(45deg);
        animation: shimmer 2s infinite;
        pointer-events: none;
      }

      .btn-voltar .material-icons {
        margin-right: 4px;
      }
      .resultado-item:last-child {
        border-bottom: none;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      /* Estilos de toast removidos - usando componente toast-notification */

      @media (max-width: 480px) {
        .toast {
          max-width: 90vw !important;
          margin: 0 20px !important;
        }
      }

      /* Adicionar estilos para feedback visual */
      .input-field input:focus {
        border-bottom: 2px solid #2196f3 !important;
        box-shadow: 0 1px 0 0 #2196f3 !important;
      }

      .input-field input:focus + label {
        color: #2196f3 !important;
      }

      /* Feedback visual para campos inválidos */
      .input-field input.invalid {
        border-bottom: 2px solid #f44336 !important;
        box-shadow: 0 1px 0 0 #f44336 !important;
      }

      .input-field input.invalid + label {
        color: #f44336 !important;
      }

      .resultado-item {
        transition: all 0.3s ease;
      }

      .resultado-item:hover {
        background-color: rgba(240, 248, 255, 0.95);
        box-shadow:
          inset 0 1px 5px rgba(0, 0, 0, 0.15),
          0 4px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(0, 123, 255, 0.3);
      }

      .resultado-atualizado {
        animation: destaque 0.5s ease-out;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      .resultado-item:hover {
        background-color: #f0f0f0;
        border-radius: 4px;
      }

      .resultado-item span {
        transition: color 0.3s ease;
      }

      .resultado-item:last-child span {
        font-weight: 700;
        color: #2196f3;
        font-size: 16px;
      }

      /* Estilo moderno para o desconto aplicado */
      .desconto-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #2196f3, #00bcd4);
        color: white;
        border-radius: 20px;
        padding: 4px 12px;
        font-weight: 600;
        box-shadow: 0 2px 5px rgba(33, 150, 243, 0.3);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      /* Removed hover animation for the desconto badge */
      .desconto-badge:hover {
        box-shadow: 0 4px 10px rgba(33, 150, 243, 0.4);
      }

      /* Variações de cores para o desconto aplicado baseado no valor */
      .desconto-badge.baixo {
        background: linear-gradient(135deg, #4caf50, #8bc34a);
        box-shadow: 0 2px 5px rgba(76, 175, 80, 0.3);
      }

      .desconto-badge.medio {
        background: linear-gradient(135deg, #ff9800, #ffc107);
        box-shadow: 0 2px 5px rgba(255, 152, 0, 0.3);
      }

      .desconto-badge.alto {
        background: linear-gradient(135deg, #f44336, #ff5722);
        box-shadow: 0 2px 5px rgba(244, 67, 54, 0.3);
      }

      .desconto-badge::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: rgba(255, 255, 255, 0.1);
        transform: rotate(45deg);
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% {
          transform: translateX(-100%) rotate(45deg);
        }
        100% {
          transform: translateX(100%) rotate(45deg);
        }
      }

      .preco-original {
        position: relative;
        color: #757575;
      }

      /* Estilo moderno para o preço original */
      .preco-original-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #2196f3, #03a9f4);
        color: white;
        border-radius: 20px;
        padding: 4px 12px;
        font-weight: 600;
        box-shadow: 0 2px 5px rgba(33, 150, 243, 0.3);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .preco-original-badge:hover {
        box-shadow: 0 4px 12px rgba(33, 150, 243, 0.2);
      }

      .preco-original-badge::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: rgba(255, 255, 255, 0.1);
        transform: rotate(45deg);
        animation: shimmer 2s infinite;
      }

      .preco-final {
        /* Removing this style as we're using badge styling now */
        display: none;
        font-weight: 700;
        font-size: 16px;
        color: #4caf50;
        display: flex;
        align-items: center;
      }

      .preco-final::before {
        content: '\e5ca';
        font-family: 'Material Icons';
        margin-right: 5px;
        font-size: 16px;
      }

      /* Melhorar responsividade para telas muito pequenas */
      /* Ajustes para telas médias */
      @media (max-width: 768px) {
        .container-principal {
          padding: 3px;
        }

        .card {
          width: 98%;
          margin: 2px;
          padding: 8px;
        }

        .card-content {
          padding: 8px !important;
        }

        .card-title {
          font-size: 20px;
          margin-bottom: 12px !important;
        }

        .resultado-item {
          padding: 6px 0;
          font-size: 13px;
        }
      }

      /* Ajustes para telas pequenas */
      @media (max-width: 480px) {
        body {
          padding: 2px;
        }

        .container-principal {
          padding: 3px;
        }

        .card {
          width: 98%;
          padding: 8px;
          margin: 2px;
        }

        .card-content {
          padding: 8px !important;
        }

        .input-field {
          margin-bottom: 10px;
        }

        .btn {
          height: 34px;
          line-height: 34px;
          font-size: 13px;
        }

        .material-icons {
          font-size: 16px !important;
        }

        #resultado-container {
          padding: 10px;
          margin-top: 10px;
        }

        .resultado-item {
          padding: 6px 0;
          font-size: 13px;
        }
      }

      /* Ajustes para telas muito pequenas */
      @media (max-width: 320px) {
        .card-title {
          font-size: 18px;
          margin-bottom: 10px !important;
        }

        .input-field {
          margin-bottom: 8px;
        }

        .input-field input,
        .input-field label {
          font-size: 12px;
        }

        .btn {
          height: 32px;
          line-height: 32px;
          font-size: 12px;
        }

        .material-icons {
          font-size: 14px !important;
        }

        .resultado-item {
          padding: 4px 0;
          font-size: 12px;
        }
      }

      /* Animação de fade-in para os cards */
      .fade-in {
        animation: fadeIn 0.5s ease forwards;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Estilos para o container do histórico e scrollbar - revisão completa */
      .historico-wrapper {
        position: relative;
        height: 480px;
        max-height: 480px;
        margin-top: 10px;
        margin-bottom: 5px;
        border-radius: 8px;
        background: rgba(217, 217, 217, 0.05);
        display: block;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
        overflow: hidden;
        padding: 10px 0 10px 10px;
      }

      /* Estilo direto e simplificado para o histórico */
      #historico-list {
        height: calc(
          100% - 20px
        ); /* Ajustado para considerar o padding superior e inferior */
        width: calc(
          100% - 10px
        ); /* Ajustado para considerar somente o padding esquerdo */
        margin: 0;
        padding: 0; /* Removido padding extra à direita */
        list-style: none;
        overflow-y: auto !important; /* Alterado de scroll para auto - só mostra quando necessário */
        overflow-x: hidden;
        position: relative;
        z-index: 1; /* Garante que a lista fique acima de outros elementos */
        transform: translateZ(0); /* Ativa aceleração de hardware */
        will-change: scroll-position; /* Otimização para rolagem */
      }

      /* Estilos limpos para os itens da lista */
      #historico-list .collection-item {
        padding: 8px 10px !important;
        margin-bottom: 5px !important;
        background-color: transparent !important;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05) !important;
      }

      /* Personalização da barra de rolagem - revisão completa */
      #historico-list::-webkit-scrollbar {
        width: 8px;
        background-color: transparent;
      }

      #historico-list::-webkit-scrollbar-track {
        background: rgba(219, 234, 254, 0.5);
        border-radius: 4px;
      }

      #historico-list::-webkit-scrollbar-thumb {
        background: rgba(37, 99, 235, 0.6);
        border-radius: 4px;
        border: 2px solid transparent;
        background-clip: padding-box;
      }

      #historico-list::-webkit-scrollbar-thumb:hover {
        background: rgba(29, 78, 216, 0.8);
        border: 2px solid transparent;
        background-clip: padding-box;
      }

      /* Para Firefox */
      #historico-list {
        scrollbar-width: thin;
        scrollbar-color: rgba(37, 99, 235, 0.6) rgba(219, 234, 254, 0.5);
      }

      /* Limpar conflitos com Materialize */
      .collection {
        border: none !important;
        margin: 0 !important;
        padding: 0 !important;
        overflow: visible !important;
      }

      /* Remover qualquer overflow oculto que possa estar interferindo */
      .card-content,
      .card {
        overflow: visible !important;
      }

      /* Estilos para o histórico vazio */
      .empty-history {
        text-align: center;
        padding: 0 !important;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
      }

      .empty-history .empty-message {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #9e9e9e;
        width: 100%;
        position: relative;
        top: 50%;
        transform: translateY(-50%);
      }

      .empty-history .empty-message i {
        font-size: 48px;
        margin-bottom: 10px;
        color: #e0e0e0;
      }

      .empty-history .empty-message p {
        margin: 5px 0;
        font-size: 16px;
      }

      .empty-history .empty-message .sub-message {
        font-size: 14px;
        color: #bdbdbd;
      }

      /* Estilos para os itens do histórico */
      .historico-item {
        padding: 12px 15px !important;
        border-radius: 8px;
        margin-bottom: 8px;
        border: 1px solid #f0f0f0;
        background-color: #f9f9f9;
        transition: all 0.2s ease;
      }

      .historico-item:hover {
        background-color: #f5f5f5;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .historico-preco {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .historico-resultado {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .valor-original {
        display: flex;
        align-items: center;
        font-weight: 500;
        color: #424242;
      }

      .valor-original i {
        margin-right: 5px;
        color: #2196f3;
      }

      .desconto {
        display: flex;
        align-items: center;
        padding: 3px 8px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
      }

      .desconto i {
        font-size: 14px !important;
        margin-right: 2px;
      }

      .desconto.baixo {
        background-color: rgba(76, 175, 80, 0.15);
        color: #4caf50;
      }

      .desconto.medio {
        background-color: rgba(255, 152, 0, 0.15);
        color: #ff9800;
      }

      .desconto.alto {
        background-color: rgba(244, 67, 54, 0.15);
        color: #f44336;
      }

      .resultado-economia {
        font-size: 13px;
        color: #757575;
      }

      .resultado-final {
        font-weight: 600;
        color: #2196f3;
        font-size: 16px;
      }

      .btn-copiar {
        background: transparent;
        border: none;
        cursor: pointer;
        padding: 5px;
        border-radius: 50%;
        color: #9e9e9e;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .btn-copiar:hover {
        background-color: rgba(33, 150, 243, 0.1);
        color: #2196f3;
      }
    </style>
  </head>
  <body class="supercalc-background">
    <noscript>
      <style>
        .no-js-message {
          display: block;
          text-align: center;
          color: red;
          font-weight: bold;
          margin-top: 20px;
        }
      </style>
      <div class="no-js-message">
        Por favor, habilite o JavaScript para usar a calculadora.
      </div>
    </noscript>

    <!-- Navegação -->
    <div
      class="nav-links"
      style="
        display: flex;
        justify-content: center;
        width: 100%;
        margin: 30px auto 0;
      "
    >
      <!-- Componente do Botão Início para SuperCalc -->
      <home-button
        href="/index.html"
        text="Início"
        icon="fa-home"
      ></home-button>
    </div>

    <!-- Importação dos componentes -->
    <script>
      // Verifica se os componentes já foram carregados
      if (!customElements.get('home-button')) {
        // Carrega o script do componente se ainda não estiver carregado
        const script = document.createElement('script');
        script.src = '/assets/js/components/home-button.js';
        document.head.appendChild(script);
      }

      // Carrega o componente calculate-button
      if (!customElements.get('calculate-button')) {
        const scriptCalc = document.createElement('script');
        scriptCalc.src = '/assets/js/components/calculate-button.js';
        document.head.appendChild(scriptCalc);
      }

      // Carrega o componente clear-button
      if (!customElements.get('clear-button')) {
        const scriptClear = document.createElement('script');
        scriptClear.src = '/assets/js/components/clear-button.js';
        document.head.appendChild(scriptClear);
      }

      // Carrega os demais componentes necessários
      if (!customElements.get('clear-history-button')) {
        const scriptClearHistory = document.createElement('script');
        scriptClearHistory.src =
          '/assets/js/components/clear-history-button.js';
        document.head.appendChild(scriptClearHistory);
      }

      if (!customElements.get('empty-history')) {
        const scriptEmptyHistory = document.createElement('script');
        scriptEmptyHistory.src = '/assets/js/components/empty-history.js';
        document.head.appendChild(scriptEmptyHistory);
      }

      if (!customElements.get('toast-notification')) {
        const scriptToast = document.createElement('script');
        scriptToast.src = '/assets/js/components/toast-notification.js';
        document.head.appendChild(scriptToast);
      }
    </script>

    <div class="container-principal">
      <div class="row">
        <!-- Coluna da Calculadora de Desconto -->
        <div class="col s12 m6">
          <div class="card fade-in">
            <div class="card-content">
              <span class="card-title" role="heading" aria-level="1"
                ><i class="fas fa-percent mr-2"></i>Calculadora de
                Desconto</span
              >
              <div class="row">
                <div class="input-field col s12 outlined">
                  <!-- Added 'outlined' class here -->
                  <input
                    id="valor"
                    type="text"
                    inputmode="decimal"
                    pattern="[0-9]+([\.\,][0-9]+)?"
                    aria-label="Valor em Reais"
                    required
                  />
                  <label for="valor">Valor (R$)</label>
                </div>
                <div class="input-field col s12">
                  <input
                    id="desconto"
                    type="number"
                    step="0.1"
                    min="0"
                    max="100"
                    aria-label="Percentual de Desconto"
                    required
                  />
                  <label for="desconto">Desconto (%)</label>
                </div>
              </div>
              <div class="btn-container">
                <calculate-button
                  id="calcular"
                  text="Calcular"
                  icon="calculate"
                  color="blue"
                  aria-label="Calcular desconto"
                ></calculate-button>
                <clear-button
                  id="limpar"
                  text="Limpar"
                  icon="clear"
                  color="red"
                  aria-label="Limpar campos"
                ></clear-button>
              </div>
              <div
                id="resultado-container"
                role="region"
                aria-label="Resultados"
              >
                <div class="resultado-item">
                  <span>Preço Original:</span>
                  <span class="preco-original-badge"
                    ><i
                      class="material-icons"
                      style="font-size: 14px; margin-right: 4px"
                      >payments</i
                    >R$ <span id="preco-original">0,00</span></span
                  >
                </div>
                <div class="resultado-item">
                  <span>Desconto Aplicado:</span>
                  <span class="desconto-badge"
                    ><i
                      class="material-icons"
                      style="font-size: 14px; margin-right: 4px"
                      >trending_down</i
                    ><span id="desconto-aplicado">0</span>%</span
                  >
                </div>
                <div class="resultado-item">
                  <span>Valor do Desconto:</span>
                  <span class="desconto-badge valor-desconto-badge"
                    ><i
                      class="material-icons"
                      style="font-size: 14px; margin-right: 4px"
                      >savings</i
                    >R$ <span id="valor-desconto">0,00</span></span
                  >
                </div>
                <div
                  class="resultado-item"
                  style="
                    border: 2px solid #4caf50;
                    background: rgba(76, 175, 80, 0.05);
                    padding: 10px 15px;
                    margin-top: 5px;
                  "
                >
                  <span
                    style="font-size: 16px; font-weight: 600; color: #4caf50"
                    >Preço Final:</span
                  >
                  <span
                    class="desconto-badge"
                    style="
                      background: linear-gradient(135deg, #4caf50, #8bc34a);
                      box-shadow: 0 4px 10px rgba(76, 175, 80, 0.5);
                      color: white;
                      font-size: 18px;
                      padding: 8px 16px;
                      border-radius: 30px;
                      position: relative;
                      transform: scale(1.05);
                    "
                  >
                    <i
                      class="material-icons"
                      style="
                        font-size: 18px;
                        margin-right: 6px;
                        vertical-align: middle;
                      "
                      >check_circle</i
                    >R$
                    <span id="resultado" style="color: white; font-weight: 700"
                      >0,00</span
                    >
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Coluna do Histórico -->
        <div class="col s12 m6">
          <div id="historico-container" class="card fade-in show">
            <div
              class="card-content"
              style="
                position: relative;
                padding: 10px !important;
                padding-bottom: 60px !important;
              "
            >
              <span
                class="card-title"
                role="heading"
                aria-level="1"
                style="margin-bottom: 10px"
                ><i class="fas fa-history mr-2"></i>Histórico de Cálculos</span
              >

              <!-- Nova div para envolver o histórico e sua barra de rolagem -->
              <div class="historico-wrapper">
                <ul id="historico-list" class="collection">
                  <!-- O componente empty-history será adicionado via JavaScript quando necessário -->
                </ul>
              </div>

              <div
                class="btn-container"
                style="
                  margin-top: 10px;
                  padding: 0;
                  text-align: center;
                  position: absolute;
                  bottom: 0px;
                  left: 0;
                  right: 0;
                "
              >
                <clear-history-button
                  storage-key="calculo-desconto-historico"
                  history-list-id="historico-list"
                  container-id="historico-container"
                  success-message="Histórico limpo com sucesso!"
                  empty-message="O histórico já está vazio!"
                ></clear-history-button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Importando Materialize JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <!-- Removidos os imports duplicados dos componentes web personalizados -->

    <script>
      // Script inicializado

      // Função para mostrar toast usando o componente web
      function showToast(message, classes = 'rounded') {
        const toast = document.createElement('toast-notification');
        toast.setAttribute('message', message);
        toast.setAttribute('classes', classes);
        document.body.appendChild(toast);
      }

      document
        .getElementById('desconto')
        .addEventListener('input', function (e) {
          const valor = parseFloat(this.value);
          if (valor > 100) {
            this.value = 100;
            this.classList.add('invalid');
            showToast('O desconto máximo é 100%', 'rounded orange');
          } else if (valor <= 0) {
            this.value = '';
            this.classList.add('invalid');
            showToast('O desconto deve ser maior que 0%', 'rounded orange');
          } else {
            this.classList.remove('invalid');
          }
        });

      // Melhorar a validação em tempo real
      function validarCampos() {
        const valorStr = document.getElementById('valor').value.trim();
        const desconto = document.getElementById('desconto').value.trim();

        // Validação do valor
        if (valorStr === '') {
          const valorInput = document.getElementById('valor');
          valorInput.classList.add('invalid');
          valorInput.focus();
          showToast('Por favor, insira um valor', 'rounded orange');
          return false;
        }

        // Normaliza o valor (substitui vírgula por ponto para cálculos)
        const valorNormalizado = valorStr.replace(',', '.');
        const valor = parseFloat(valorNormalizado);

        if (isNaN(valor) || valor <= 0) {
          const valorInput = document.getElementById('valor');
          valorInput.classList.add('invalid');
          valorInput.focus();
          showToast(
            'Por favor, insira um valor válido positivo',
            'rounded orange'
          );
          return false;
        }

        // Validação de desconto
        if (
          desconto === '' ||
          isNaN(parseFloat(desconto)) ||
          parseFloat(desconto) <= 0 ||
          parseFloat(desconto) > 100
        ) {
          const descontoInput = document.getElementById('desconto');
          descontoInput.classList.add('invalid');
          descontoInput.focus();
          showToast(
            'Por favor, insira um desconto válido (maior que 0 e até 100)',
            'rounded orange'
          );
          return false;
        }

        return true;
      }

      // A função showToast já foi declarada anteriormente

      document
        .getElementById('calcular')
        .addEventListener('click', calcularDesconto);
      document.getElementById('limpar').addEventListener('click', limparCampos);

      // Adicionar suporte a tecla Enter
      document.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
          calcularDesconto();
        }
      });

      // Função para validar e destacar campos
      function validarCampo(input, condicao, mensagem) {
        if (!condicao) {
          input.classList.add('invalid');
          showToast(mensagem, 'rounded red');
          input.focus();
          return false;
        }
        input.classList.remove('invalid');
        return true;
      }

      function adicionarAoHistorico(preco, desconto, resultado) {
        // Formata os valores para garantir que sempre tenham duas casas decimais
        const precoFormatado =
          typeof preco === 'string'
            ? preco
            : preco.toFixed(2).replace('.', ',');
        const resultadoFormatado =
          typeof resultado === 'string'
            ? resultado
            : resultado.toFixed(2).replace('.', ',');

        // Calcula a economia (diferença entre preço original e final)
        const precoOriginal =
          typeof preco === 'string'
            ? parseFloat(preco.replace(',', '.'))
            : preco;
        const precoFinal =
          typeof resultado === 'string'
            ? parseFloat(resultado.replace(',', '.'))
            : resultado;
        const economia = (precoOriginal - precoFinal)
          .toFixed(2)
          .replace('.', ',');

        // Determina a classe do desconto com base no valor percentual
        const descontoNum = parseFloat(desconto);
        let descontoClasse = 'baixo';
        if (descontoNum >= 30) {
          descontoClasse = 'alto';
        } else if (descontoNum >= 15) {
          descontoClasse = 'medio';
        }

        // Obtém a lista de histórico
        const historicoList = document.getElementById('historico-list');

        // Antes de adicionar um novo item, verifica e remove a mensagem de histórico vazio
        const emptyHistory = historicoList.querySelector('empty-history');
        if (emptyHistory) {
          historicoList.removeChild(emptyHistory);
        }

        // Criar novo item de histórico
        const novoItem = document.createElement('li');
        novoItem.className = 'collection-item historico-item';

        // Formatando o HTML do item
        novoItem.innerHTML = `
          <div class="historico-preco">
            <span class="valor-original">
              <i class="material-icons">payments</i> R$ ${precoFormatado}
            </span>
            <span class="desconto ${descontoClasse}">
              <i class="material-icons">trending_down</i> ${desconto}%
            </span>
          </div>
          <div class="historico-resultado">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="resultado-economia">Economia: R$ ${economia}</span>
              <span class="resultado-final">R$ ${resultadoFormatado}</span>
            </div>
            <button class="btn-copiar" title="Copiar resultado">
              <i class="material-icons">content_copy</i>
            </button>
          </div>
        `;

        // Adicionar evento para o botão de copiar
        const btnCopiar = novoItem.querySelector('.btn-copiar');
        if (btnCopiar) {
          btnCopiar.addEventListener('click', function () {
            // Copiar apenas o valor numérico sem o símbolo R$
            copiarParaAreaDeTransferencia(resultadoFormatado);
          });
        }

        // Adicionar ao início da lista
        historicoList.insertBefore(novoItem, historicoList.firstChild);

        // Limitar o histórico a 30 itens
        if (historicoList.children.length > 30) {
          historicoList.removeChild(historicoList.lastChild);
        }

        // Salvar no localStorage
        salvarHistorico();

        // Mostrar o container de histórico
        document.getElementById('historico-container').classList.add('show');
      }

      // Função para copiar para a área de transferência
      function copiarParaAreaDeTransferencia(texto) {
        navigator.clipboard
          .writeText(texto)
          .then(() => {
            showToast(
              'Resultado copiado para a área de transferência!',
              'green rounded'
            );
          })
          .catch((err) => {
            console.error('Erro ao copiar: ', err);
            showToast('Não foi possível copiar o resultado.', 'red rounded');
          });
      }

      // Função para salvar o histórico no localStorage
      function salvarHistorico() {
        const historicoList = document.getElementById('historico-list');
        const itens = Array.from(historicoList.children)
          .filter((item) => !item.matches('empty-history'))
          .map((item) => item.outerHTML);

        localStorage.setItem(
          'calculo-desconto-historico',
          JSON.stringify(itens)
        );
      }

      // Função para carregar o histórico do localStorage
      function carregarHistorico() {
        const historicoSalvo = localStorage.getItem(
          'calculo-desconto-historico'
        );
        const historicoList = document.getElementById('historico-list');

        if (historicoSalvo && JSON.parse(historicoSalvo).length > 0) {
          const itens = JSON.parse(historicoSalvo);

          // Limpar a lista atual
          historicoList.innerHTML = '';

          // Adicionar os itens salvos
          itens.forEach((item) => {
            const novoItemElement = document.createElement('div');
            novoItemElement.innerHTML = item;
            const novoItem = novoItemElement.firstChild;

            // Readicionar evento para o botão de copiar
            const btnCopiar = novoItem.querySelector('.btn-copiar');
            if (btnCopiar) {
              btnCopiar.addEventListener('click', function () {
                const resultadoFinal =
                  novoItem.querySelector('.resultado-final').textContent;
                // Remover o símbolo R$ antes de copiar
                const valorNumerico = resultadoFinal.replace('R$ ', '');
                copiarParaAreaDeTransferencia(valorNumerico);
              });
            }

            historicoList.appendChild(novoItem);
          });

          // Mostrar o container de histórico
          document.getElementById('historico-container').classList.add('show');
        } else {
          // Mostrar o componente de histórico vazio usando o web component
          historicoList.innerHTML = '';
          const emptyHistory = document.createElement('empty-history');
          emptyHistory.setAttribute(
            'message',
            'Nenhum registro encontrado no histórico.'
          );
          emptyHistory.setAttribute(
            'sub-message',
            'Os registros salvos aparecerão aqui.'
          );
          historicoList.appendChild(emptyHistory);

          // Mostrar o container de histórico
          document.getElementById('historico-container').classList.add('show');
        }
      }

      // Função para limpar o histórico
      function limparHistorico() {
        const historicoList = document.getElementById('historico-list');

        // Verificar se o histórico já está vazio
        if (!historicoList || historicoList.querySelector('empty-history')) {
          showToast('O histórico já está vazio!', 'orange rounded');
          return;
        }

        // Limpa a lista
        historicoList.innerHTML = '';

        // Adicionar o componente de histórico vazio
        const emptyHistory = document.createElement('empty-history');
        emptyHistory.setAttribute(
          'message',
          'Nenhum registro encontrado no histórico.'
        );
        emptyHistory.setAttribute(
          'sub-message',
          'Os registros salvos aparecerão aqui.'
        );
        historicoList.appendChild(emptyHistory);

        // Remover do localStorage
        localStorage.removeItem('calculo-desconto-historico');

        // Mostrar toast de sucesso
        showToast('Histórico limpo com sucesso!', 'green rounded');
      }

      function calcularDesconto() {
        const valorInput = document.getElementById('valor');
        const descontoInput = document.getElementById('desconto');

        if (!validarCampos()) return;

        // Obter o valor e normalizar (substituir vírgula por ponto para cálculos)
        const valorStr = valorInput.value.trim();
        const valorNormalizado = valorStr.replace(',', '.');
        const precoOriginal = parseFloat(valorNormalizado);

        const desconto = parseFloat(descontoInput.value.trim());

        // Calcular o valor do desconto
        const valorDescontoCalculado = precoOriginal * (desconto / 100);

        // Calcular o preço final
        const precoFinal = precoOriginal - valorDescontoCalculado;

        // Atualizar os elementos na interface
        document.getElementById('preco-original').textContent = precoOriginal
          .toFixed(2)
          .replace('.', ',');
        document.getElementById('desconto-aplicado').textContent = desconto;
        document.getElementById('valor-desconto').textContent =
          valorDescontoCalculado.toFixed(2).replace('.', ',');
        document.getElementById('resultado').textContent = precoFinal
          .toFixed(2)
          .replace('.', ',');

        // Adicionar ao histórico
        adicionarAoHistorico(
          precoOriginal.toFixed(2).replace('.', ','),
          desconto,
          precoFinal.toFixed(2).replace('.', ',')
        );

        // Mostrar toast de sucesso
        showToast('Desconto calculado com sucesso!', 'rounded green');
      }

      function limparCampos() {
        const valorInput = document.getElementById('valor');
        const descontoInput = document.getElementById('desconto');
        const precoOriginal = document.getElementById('preco-original');
        const descontoAplicado = document.getElementById('desconto-aplicado');
        const valorDesconto = document.getElementById('valor-desconto');
        const resultado = document.getElementById('resultado');

        // Verifica se os campos já estão limpos
        if (
          valorInput.value === '' &&
          descontoInput.value === '' &&
          precoOriginal.textContent === '0,00' &&
          descontoAplicado.textContent === '0' &&
          valorDesconto.textContent === '0,00' &&
          resultado.textContent === '0,00'
        ) {
          showToast('Os campos já estão limpos!', 'rounded orange');
          return;
        }

        // Limpa os campos
        valorInput.value = '';
        descontoInput.value = '';
        precoOriginal.textContent = '0,00';
        descontoAplicado.textContent = '0';
        valorDesconto.textContent = '0,00';
        resultado.textContent = '0,00';

        // Remove classes de invalidação
        valorInput.classList.remove('invalid');
        descontoInput.classList.remove('invalid');

        // Remove a classe active dos labels
        const labels = document.querySelectorAll('.input-field label');
        labels.forEach((label) => {
          label.classList.remove('active');
        });

        // Remove qualquer estilo inline que possa ter sido adicionado
        valorInput.style.borderBottom = '';
        valorInput.style.boxShadow = '';
        descontoInput.style.borderBottom = '';
        descontoInput.style.boxShadow = '';

        // Atualiza campos do Materialize
        M.updateTextFields();
        showToast('Campos limpos!', 'rounded blue');
      }

      // Inicializar componentes Materialize
      document.addEventListener('DOMContentLoaded', function () {
        M.updateTextFields();
        // Definir foco inicial no campo de valor
        document.getElementById('valor').focus();

        // A inicialização do gerenciador de histórico já foi feita no início do arquivo
      });

      // Listeners para eventos de cópia
      document.addEventListener('copy-success', function (e) {
        showToast(e.detail.message, 'green rounded');
      });

      // Adicionando o listener para eventos de erro na cópia que estava faltando
      document.addEventListener('copy-error', function (e) {
        showToast(e.detail.message, 'red rounded');
      });

      // Adicionar validação de input para permitir números e separadores decimais
      document
        .getElementById('valor')
        .addEventListener('keypress', function (e) {
          // Permite apenas números
          if (!/\d/.test(e.key)) {
            e.preventDefault();
          }
        });

      document
        .getElementById('desconto')
        .addEventListener('keypress', function (e) {
          if (!/[\d.]/.test(e.key)) {
            e.preventDefault();
          }
        });

      document
        .getElementById('desconto')
        .addEventListener('wheel', function (e) {
          e.preventDefault();
          let valor = parseInt(this.value);
          if (e.deltaY < 0) {
            valor = Math.min(100, valor + 1);
          } else {
            valor = Math.max(0, valor - 1);
          }
          this.value = valor;
        });

      document.getElementById('valor').addEventListener('input', function (e) {
        let valor = e.target.value.replace(/\D/g, '');
        if (valor === '') return;

        valor = (parseFloat(valor) / 100).toFixed(2);
        e.target.value = valor.replace('.', ',');
      });
    </script>

    <!-- Container do Histórico -->
  </body>
</html>
