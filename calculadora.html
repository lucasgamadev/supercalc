<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Calculadora de desconto simples e eficiente para calcular valores com desconto em Reais"
    />
    <title>Calculadora de Desconto</title>
    <!-- Importando Materialize CSS e Ícones -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
      rel="stylesheet"
    />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        font-family: "Roboto", sans-serif;
      }

      #historico-container {
        position: relative;
        width: 100%;
        transition:
          opacity 0.3s ease,
          transform 0.3s ease;
        opacity: 0;
        transform: translateY(-20px);
      }

      #historico-container.show {
        opacity: 1;
        transform: translateY(0);
      }

      body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        background: linear-gradient(135deg, #00796b, #1565c0);
        background-attachment: fixed;
      }

      .container-principal {
        position: relative;
        display: flex;
        flex-direction: row;
        align-items: flex-start;
        width: 100%;
        max-width: 900px;
        padding: 5px;
        margin: 0 auto;
      }

      .container-principal .row {
        display: flex;
        flex-wrap: wrap;
        width: 100%;
      }

      .container-principal .col {
        display: flex;
      }

      .card {
        width: 100%;
        max-width: 900px;
        padding: 10px;
        margin: 5px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 12px !important;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        display: flex;
        flex-direction: column;
      }

      .card-content {
        padding: 10px !important;
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      #historico-list {
        flex: 1;
        margin: 0;
        border: none;
        max-height: 357px;
        overflow-y: auto;
      }

      .collection {
        border: none !important;
        margin: 0 !important;
      }

      @media (max-width: 768px) {
        .container-principal {
          flex-direction: column;
          align-items: center;
        }

        .container-principal .row {
          flex-direction: column;
        }

        #historico-list {
          max-height: 300px;
        }
      }

      .card-title {
        text-align: center;
        display: block;
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 15px !important;
        background: linear-gradient(45deg, #2196f3, #00bcd4);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        letter-spacing: 0.5px;
        position: relative;
        padding-bottom: 8px;
      }

      .card-title::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 40px;
        height: 2px;
        background: linear-gradient(45deg, #2196f3, #00bcd4);
        border-radius: 2px;
      }

      @media (max-width: 480px) {
        .card-title {
          font-size: 20px;
        }
      }

      .row {
        margin-bottom: 0;
      }

      .input-field {
        margin-bottom: 12px;
      }

      .input-field input {
        margin-bottom: 0 !important;
        padding: 0 10px !important;
        box-sizing: border-box;
        font-size: 14px;
        font-family: "Roboto", sans-serif !important;
      }

      .input-field label {
        left: 10px;
        font-size: 14px;
        font-family: "Roboto", sans-serif !important;
      }

      .btn-container {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
      }

      .btn {
        flex: 1;
        height: 36px;
        line-height: 36px;
        font-size: 14px;
        text-transform: none;
        border-radius: 6px;
        box-shadow: none;
        font-family: "Roboto", sans-serif !important;
      }

      #resultado-container {
        background: #f5f5f5;
        border-radius: 6px;
        padding: 12px;
        margin-top: 12px;
      }

      .resultado-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #e0e0e0;
        font-size: 14px;
        font-family: "Roboto", sans-serif;
      }

      .material-icons {
        font-size: 18px !important;
      }

      .resultado-item:last-child {
        border-bottom: none;
      }

      @keyframes slideIn {
        from {
          transform: translateY(100%);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .toast {
        animation: slideIn 0.15s ease-out;
        justify-content: center;
        text-align: center;
        font-size: 16px !important;
        border-radius: 8px !important;
        padding: 12px 24px !important;
        background-color: rgba(0, 0, 0, 0.85) !important;
        color: white !important;
        font-weight: 500 !important;
        width: auto !important;
        min-width: 0 !important;
        margin: 0 !important;
        display: inline-block !important;
        pointer-events: auto;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
        font-family: "Roboto", sans-serif !important;
      }

      /* Estilos para os toasts */
      #toast-container {
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        position: fixed !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        width: auto !important;
        max-width: none !important;
        height: auto !important;
        pointer-events: none;
      }

      .toast.red {
        background-color: rgba(244, 67, 54, 0.95) !important;
      }

      .toast.green {
        background-color: rgba(76, 175, 80, 0.95) !important;
      }

      .toast.blue {
        background-color: rgba(33, 150, 243, 0.95) !important;
      }

      @media (max-width: 480px) {
        .toast {
          max-width: 90vw !important;
          margin: 0 20px !important;
        }
      }

      /* Adicionar estilos para feedback visual */
      .input-field input:focus {
        border-bottom: 2px solid #2196f3 !important;
        box-shadow: 0 1px 0 0 #2196f3 !important;
      }

      .input-field input:focus + label {
        color: #2196f3 !important;
      }

      /* Feedback visual para campos inválidos */
      .input-field input.invalid {
        border-bottom: 2px solid #f44336 !important;
        box-shadow: 0 1px 0 0 #f44336 !important;
      }

      .input-field input.invalid + label {
        color: #f44336 !important;
      }

      .resultado-item {
        transition: all 0.3s ease;
      }

      .resultado-atualizado {
        animation: destaque 0.5s ease-out;
      }

      .historico-item {
        display: flex;
        flex-direction: column;
        padding: 8px 12px !important;
        border-bottom: 1px solid #e0e0e0 !important;
      }

      .historico-item:last-child {
        border-bottom: none !important;
      }

      .historico-preco {
        font-size: 1.1em;
        margin-bottom: 8px;
      }

      .historico-preco .valor-original {
        color: #2196f3;
      }

      .historico-preco .desconto {
        color: #000000;
      }

      .historico-final {
        color: #4caf50;
        font-weight: 500;
        font-size: 1.1em;
      }

      .historico-item {
        display: flex;
        flex-direction: column;
        padding: 12px !important;
        border-bottom: 1px solid #e0e0e0 !important;
      }

      @keyframes destaque {
        0% {
          background-color: #e3f2fd;
        }
        100% {
          background-color: transparent;
        }
      }

      .resultado-item:hover {
        background-color: #f0f0f0;
        border-radius: 4px;
      }

      .resultado-item span {
        transition: color 0.3s ease;
      }

      .resultado-item:last-child span {
        font-weight: 500;
        color: #2196f3;
      }

      /* Melhorar responsividade para telas muito pequenas */
      /* Ajustes para telas médias */
      @media (max-width: 768px) {
        .container-principal {
          padding: 3px;
        }

        .card {
          width: 98%;
          margin: 2px;
          padding: 8px;
        }

        .card-content {
          padding: 8px !important;
        }

        .card-title {
          font-size: 20px;
          margin-bottom: 12px !important;
        }

        .resultado-item {
          padding: 6px 0;
          font-size: 13px;
        }
      }

      /* Ajustes para telas pequenas */
      @media (max-width: 480px) {
        body {
          padding: 2px;
        }

        .container-principal {
          padding: 3px;
        }

        .card {
          width: 98%;
          padding: 8px;
          margin: 2px;
        }

        .card-content {
          padding: 8px !important;
        }

        .input-field {
          margin-bottom: 10px;
        }

        .btn {
          height: 34px;
          line-height: 34px;
          font-size: 13px;
        }

        .material-icons {
          font-size: 16px !important;
        }

        #resultado-container {
          padding: 10px;
          margin-top: 10px;
        }

        .resultado-item {
          padding: 6px 0;
          font-size: 13px;
        }
      }

      /* Ajustes para telas muito pequenas */
      @media (max-width: 320px) {
        .card-title {
          font-size: 18px;
          margin-bottom: 10px !important;
        }

        .input-field {
          margin-bottom: 8px;
        }

        .input-field input,
        .input-field label {
          font-size: 12px;
        }

        .btn {
          height: 32px;
          line-height: 32px;
          font-size: 12px;
        }

        .material-icons {
          font-size: 14px !important;
        }

        .resultado-item {
          padding: 4px 0;
          font-size: 12px;
        }
      }

      /* Ajuste do toast para diferentes tamanhos de tela */
      @media (max-width: 480px) {
        #toast-container {
          width: 90% !important;
          left: 5% !important;
          transform: translateY(-50%) !important;
        }

        .toast {
          font-size: 14px !important;
          padding: 10px 15px !important;
          width: 100% !important;
        }
      }
    </style>
  </head>
  <body>
    <noscript>
      <style>
        .no-js-message {
          display: block;
          text-align: center;
          color: red;
          font-weight: bold;
          margin-top: 20px;
        }
      </style>
      <div class="no-js-message">Por favor, habilite o JavaScript para usar a calculadora.</div>
    </noscript>

    <div class="container-principal">
      <div class="row">
        <div class="col s12 m6">
          <div class="card">
            <div class="card-content">
              <span class="card-title" role="heading" aria-level="1">Calculadora de Desconto</span>
              <div class="row">
                <div class="input-field col s6">
                  <input
                    id="preco-reais"
                    type="number"
                    min="0"
                    inputmode="numeric"
                    pattern="[0-9]*"
                    aria-label="Reais"
                    required
                  />
                  <label for="preco-reais">Reais (R$)</label>
                </div>
                <div class="input-field col s6">
                  <input
                    id="preco-centavos"
                    type="number"
                    min="0"
                    max="99"
                    inputmode="numeric"
                    pattern="[0-9]*"
                    aria-label="Centavos"
                    required
                  />
                  <label for="preco-centavos">Centavos</label>
                </div>
                <div class="input-field col s12">
                  <input
                    id="desconto"
                    type="number"
                    step="0.1"
                    min="0"
                    max="100"
                    aria-label="Percentual de Desconto"
                    required
                  />
                  <label for="desconto">Desconto (%)</label>
                </div>
              </div>
              <div class="btn-container">
                <button
                  id="calcular"
                  class="btn waves-effect waves-light blue"
                  aria-label="Calcular desconto"
                >
                  <i class="material-icons left" aria-hidden="true">calculate</i>
                  Calcular
                </button>
                <button
                  id="limpar"
                  class="btn waves-effect waves-light red"
                  aria-label="Limpar campos"
                >
                  <i class="material-icons left" aria-hidden="true">clear</i>
                  Limpar
                </button>
              </div>
              <div id="resultado-container" role="region" aria-label="Resultados">
                <div class="resultado-item">
                  <span>Preço Original:</span>
                  <span>R$ <span id="preco-original">0.00</span></span>
                </div>
                <div class="resultado-item">
                  <span>Desconto Aplicado:</span>
                  <span><span id="desconto-aplicado">0</span>%</span>
                </div>
                <div class="resultado-item">
                  <span>Valor do Desconto:</span>
                  <span>R$ <span id="valor-desconto">0.00</span></span>
                </div>
                <div class="resultado-item">
                  <span>Preço Final:</span>
                  <span>R$ <span id="resultado">0.00</span></span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col s12 m6">
          <div class="card">
            <div class="card-content">
              <span class="card-title" role="heading" aria-level="1">Histórico de Cálculos</span>
              <!-- Função para validar e destacar campos -->
              <script>
                function validarCampo(input, condicao, mensagem) {
                  if (!condicao) {
                    input.classList.add("invalid");
                    showToast(mensagem, "rounded red");
                    input.focus();
                    return false;
                  }
                  input.classList.remove("invalid");
                  return true;
                }
              </script>
              <ul
                id="historico-list"
                class="collection"
                style="max-height: 400px; overflow-y: auto"
              >
                <!-- History items will be appended here -->
              </ul>
              <div class="btn-container" style="margin-top: 15px; text-align: center">
                <button
                  id="limpar-historico"
                  class="btn waves-effect waves-light orange"
                  aria-label="Limpar histórico"
                >
                  <i class="material-icons left" aria-hidden="true">delete_sweep</i>
                  Limpar Histórico
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="toast-container"></div>

    <!-- Importando Materialize JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
      // Add event listeners for the new price fields
      document.getElementById("preco-centavos").addEventListener("input", function (e) {
        let valor = parseInt(this.value);
        if (valor > 99) {
          this.value = 99;
          this.classList.add("invalid");
          showToast("O valor máximo para centavos é 99", "rounded orange");
        } else if (valor < 0) {
          this.value = 0;
          this.classList.add("invalid");
          showToast("O valor mínimo para centavos é 0", "rounded orange");
        } else if (!isNaN(valor)) {
          this.classList.remove("invalid");
        }
      });

      document.getElementById("preco-reais").addEventListener("input", function (e) {
        let valor = parseInt(this.value);
        if (valor < 0) {
          this.value = 0;
          this.classList.add("invalid");
          showToast("O valor mínimo para reais é 0", "rounded orange");
        } else if (!isNaN(valor)) {
          this.classList.remove("invalid");
        }
      });

      document.getElementById("desconto").addEventListener("input", function (e) {
        const valor = parseFloat(this.value);
        if (valor > 100) {
          this.value = 100;
          this.classList.add("invalid");
          showToast("O desconto máximo é 100%", "rounded orange");
        } else if (valor < 0) {
          this.value = 0;
          this.classList.add("invalid");
          showToast("O desconto mínimo é 0%", "rounded orange");
        } else {
          this.classList.remove("invalid");
        }
      });

      // Melhorar a validação em tempo real
      function validarCampos() {
        const reais = document.getElementById("preco-reais").value.trim();
        const centavos = document.getElementById("preco-centavos").value.trim();
        const desconto = document.getElementById("desconto").value.trim();

        // Validação de reais
        if (reais === "" || isNaN(parseInt(reais)) || parseInt(reais) < 0) {
          const reaisInput = document.getElementById("preco-reais");
          reaisInput.classList.add("invalid");
          reaisInput.focus();
          showToast("Por favor, insira um valor válido para reais", "rounded orange");
          return false;
        }

        // Validação de centavos
        if (
          centavos === "" ||
          isNaN(parseInt(centavos)) ||
          parseInt(centavos) < 0 ||
          parseInt(centavos) > 99
        ) {
          const centavosInput = document.getElementById("preco-centavos");
          centavosInput.classList.add("invalid");
          centavosInput.focus();
          showToast("Por favor, insira um valor válido para centavos (0-99)", "rounded orange");
          return false;
        }

        // Validação de desconto
        if (
          desconto === "" ||
          isNaN(parseFloat(desconto)) ||
          parseFloat(desconto) < 0 ||
          parseFloat(desconto) > 100
        ) {
          const descontoInput = document.getElementById("desconto");
          descontoInput.classList.add("invalid");
          descontoInput.focus();
          showToast("Por favor, insira um desconto válido (0-100)", "rounded orange");
          return false;
        }

        return true;
      }

      function showToast(message, classes) {
        // Remove toasts anteriores
        const existingToasts = document.querySelectorAll(".toast");
        existingToasts.forEach((toast) => toast.remove());

        M.toast({
          html: message,
          classes: `${classes} center-align`,
          displayLength: 1000, // Reduzido para 1 segundo
          inDuration: 150, // Animação de entrada mais rápida
          outDuration: 150 // Animação de saída mais rápida
        });

        // Garante que o container está posicionado corretamente
        const toastContainer = document.getElementById("toast-container");
        if (toastContainer) {
          toastContainer.style.display = "flex";
          toastContainer.style.justifyContent = "center";
          toastContainer.style.alignItems = "center";
        }
      }

      document.getElementById("calcular").addEventListener("click", calcularDesconto);
      document.getElementById("limpar").addEventListener("click", limparCampos);
      document.getElementById("limpar-historico").addEventListener("click", limparHistorico);

      function limparHistorico() {
        const historico = document.getElementById("historico-list");

        // Verifica se o histórico já está vazio
        if (historico.children.length === 0) {
          showToast("O histórico já está vazio!", "rounded orange");
          return;
        }

        // Remove todos os itens do histórico
        while (historico.firstChild) {
          historico.removeChild(historico.firstChild);
        }

        showToast("Histórico limpo com sucesso!", "rounded green");
      }

      // Adicionar suporte a tecla Enter
      document.addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
          calcularDesconto();
        }
      });

      // Função para validar e destacar campos
      function validarCampo(input, condicao, mensagem) {
        if (!condicao) {
          input.classList.add("invalid");
          showToast(mensagem, "rounded red");
          input.focus();
          return false;
        }
        input.classList.remove("invalid");
        return true;
      }

      function adicionarAoHistorico(preco, desconto, resultado) {
        const historico = document.getElementById("historico-list");
        const maxHistoricoItems = 5;

        const item = document.createElement("li");
        item.className = "collection-item historico-item";

        // Formata os valores para garantir que sempre tenham duas casas decimais
        const precoFormatado =
          typeof preco === "string" ? preco : preco.toFixed(2).replace(".", ",");
        const resultadoFormatado =
          typeof resultado === "string" ? resultado : resultado.toFixed(2).replace(".", ",");

        item.innerHTML = `
            <div class="historico-preco">
                <span class="valor-original">Valor Original: R$ ${precoFormatado}</span> <span class="desconto">(Desconto: ${desconto}%)</span>
            </div>
            <div class="historico-final">
                Valor Final: R$ ${resultadoFormatado}
            </div>
        `;

        // Adiciona efeito de fade in
        item.style.opacity = "0";
        item.style.transform = "translateY(-10px)";
        item.style.transition = "all 0.3s ease";

        // Remove itens antigos se exceder o limite
        while (historico.children.length >= maxHistoricoItems) {
          historico.removeChild(historico.lastChild);
        }

        historico.insertBefore(item, historico.firstChild);

        // Força o reflow para a animação funcionar
        item.offsetHeight;

        // Aplica a animação
        item.style.opacity = "1";
        item.style.transform = "translateY(0)";
      }

      // Adicionar validação de input para permitir apenas números
      document.getElementById("preco-reais").addEventListener("keypress", function (e) {
        if (!/[\d]/.test(e.key)) {
          e.preventDefault();
        }
      });

      document.getElementById("preco-centavos").addEventListener("keypress", function (e) {
        if (!/[\d]/.test(e.key)) {
          e.preventDefault();
        }
      });

      document.getElementById("desconto").addEventListener("keypress", function (e) {
        if (!/[\d.]/.test(e.key)) {
          e.preventDefault();
        }
      });

      function calcularDesconto() {
        if (!validarCampos()) return;

        const reaisInput = document.getElementById("preco-reais");
        const centavosInput = document.getElementById("preco-centavos");
        const descontoInput = document.getElementById("desconto");

        const reais = parseInt(reaisInput.value.trim());
        const centavos = parseInt(centavosInput.value.trim());
        const desconto = parseFloat(descontoInput.value.trim());

        // Cálculos com precisão melhorada
        const precoTotal = parseFloat((reais + centavos / 100).toFixed(2));
        const valorDesconto = parseFloat((precoTotal * (desconto / 100)).toFixed(2));
        const resultado = parseFloat((precoTotal - valorDesconto).toFixed(2));

        // Atualizar resultados com animação
        const resultados = document.querySelectorAll(".resultado-item");
        resultados.forEach((item) => {
          item.classList.add("resultado-atualizado");
          setTimeout(() => item.classList.remove("resultado-atualizado"), 500);
        });

        // Atualização dos resultados
        document.getElementById("preco-original").textContent =
          `${reais},${centavos.toString().padStart(2, "0")}`;
        document.getElementById("desconto-aplicado").textContent = desconto;
        document.getElementById("valor-desconto").textContent = valorDesconto
          .toFixed(2)
          .replace(".", ",");
        document.getElementById("resultado").textContent = resultado.toFixed(2).replace(".", ",");

        // Adicionar ao histórico
        adicionarAoHistorico(
          document.getElementById("preco-original").textContent,
          document.getElementById("desconto-aplicado").textContent,
          document.getElementById("resultado").textContent
        );

        showToast("Cálculo realizado com sucesso!", "rounded green");

        // Limpar os campos de entrada após o cálculo
        reaisInput.value = "";
        centavosInput.value = "";
        descontoInput.value = "";

        // Remove classes de invalidação
        reaisInput.classList.remove("invalid");
        centavosInput.classList.remove("invalid");
        descontoInput.classList.remove("invalid");

        // Atualiza os campos do Materialize
        M.updateTextFields();
      }

      function limparCampos() {
        const reaisInput = document.getElementById("preco-reais");
        const centavosInput = document.getElementById("preco-centavos");
        const descontoInput = document.getElementById("desconto");
        const precoOriginal = document.getElementById("preco-original");
        const descontoAplicado = document.getElementById("desconto-aplicado");
        const valorDesconto = document.getElementById("valor-desconto");
        const resultado = document.getElementById("resultado");

        // Verifica se os campos já estão limpos
        if (
          reaisInput.value === "" &&
          centavosInput.value === "" &&
          descontoInput.value === "" &&
          precoOriginal.textContent === "0,00" &&
          descontoAplicado.textContent === "0" &&
          valorDesconto.textContent === "0,00" &&
          resultado.textContent === "0,00"
        ) {
          showToast("Os campos já estão limpos!", "rounded orange");
          return;
        }

        // Limpa os campos
        reaisInput.value = "";
        centavosInput.value = "";
        descontoInput.value = "";
        precoOriginal.textContent = "0,00";
        descontoAplicado.textContent = "0";
        valorDesconto.textContent = "0,00";
        resultado.textContent = "0,00";

        // Remove classes de invalidação
        reaisInput.classList.remove("invalid");
        centavosInput.classList.remove("invalid");
        descontoInput.classList.remove("invalid");

        // Remove a classe active dos labels
        const labels = document.querySelectorAll(".input-field label");
        labels.forEach((label) => {
          label.classList.remove("active");
        });

        // Remove qualquer estilo inline que possa ter sido adicionado
        reaisInput.style.borderBottom = "";
        reaisInput.style.boxShadow = "";
        centavosInput.style.borderBottom = "";
        centavosInput.style.boxShadow = "";
        descontoInput.style.borderBottom = "";
        descontoInput.style.boxShadow = "";

        // Atualiza campos do Materialize
        M.updateTextFields();
        showToast("Campos limpos!", "rounded blue");
      }

      // Inicializar componentes Materialize
      document.addEventListener("DOMContentLoaded", function () {
        M.updateTextFields();
        // Definir foco inicial no campo de reais
        document.getElementById("preco-reais").focus();
      });
    </script>
  </body>
</html>
